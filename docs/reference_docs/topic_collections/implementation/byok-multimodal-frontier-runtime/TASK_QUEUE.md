# BYOK Multimodal Frontier Runtime Task Queue

**Last updated:** 2026-02-19  
**Workstream root:** `/Users/foundbrand_001/Development/vc83-com/docs/reference_docs/topic_collections/implementation/byok-multimodal-frontier-runtime`  
**Source request:** Deep codebase-wide BYOK expansion plan for multi-provider API keys in Integrations UI, private model connections, multimodal/voice support, and credit/economics alignment.

---

## Queue rules

1. Allowed statuses are only: `READY`, `IN_PROGRESS`, `PENDING`, `BLOCKED`, `DONE`.
2. Only one task may be `IN_PROGRESS` globally unless concurrency rules explicitly allow one per lane.
3. Promote a task from `PENDING` to `READY` only when all dependencies are `DONE`.
4. Selection order is deterministic: highest priority (`P0` -> `P1` -> `P2`) then lowest task ID.
5. If a task is `BLOCKED`, capture blocker details in row `Notes` and continue with the next `READY` task.
6. Every task must include explicit verification commands before moving to `DONE`.
7. Keep lane boundaries strict to reduce merge conflicts.
8. Sync `INDEX.md`, `MASTER_PLAN.md`, and `TASK_QUEUE.md` after each completed task.

---

## Verification profiles

| Profile | Command |
|---|---|
| `V-TYPE` | `npm run typecheck` |
| `V-LINT` | `npm run lint` |
| `V-UNIT` | `npm run test:unit` |
| `V-MODEL` | `npm run test:model` |
| `V-INTEGRATION` | `npm run test:integration` |
| `V-DOCS` | `npm run docs:guard` |
| `V-AI-LINT` | `npx eslint convex/ai convex/schemas/aiSchemas.ts convex/credits/index.ts convex/channels` |
| `V-INTEGRATION-LINT` | `npx eslint convex/integrations convex/oauth convex/channels/router.ts convex/channels/registry.ts` |
| `V-UI-LINT` | `npx eslint src/components/window-content/integrations-window src/components/window-content/org-owner-manage-window/ai-settings-tab.tsx src/hooks/use-ai-config.ts` |

---

## Execution lanes

| Lane | Purpose | Primary ownership | Merge-overlap policy |
|---|---|---|---|
| `A` | Target contract and schema baseline | `docs/reference_docs/topic_collections/implementation/byok-multimodal-frontier-runtime/*`; `convex/schemas/aiSchemas.ts`; `convex/ai/settings.ts` | No runtime/UI implementation before lane `A` contract rows are `DONE` |
| `B` | Provider credential vault and registry | `convex/oauth/encryption.ts`; `convex/channels/registry.ts`; `convex/channels/router.ts`; `convex/integrations/*` | Avoid routing/fallback logic changes in lane `B` |
| `C` | Runtime adapters, auth profiles, and model routing | `convex/ai/*`; `convex/ai/openrouter.ts`; new provider adapter modules | No billing policy edits in lane `C` |
| `D` | Credits, BYOK monetization policy, and billing unification | `convex/credits/index.ts`; `convex/ai/chat.ts`; `convex/ai/agentExecution.ts`; `convex/ai/billing.ts`; `convex/stripe/*` | No integrations UI edits in lane `D` |
| `E` | Integrations and AI settings product surfaces | `src/components/window-content/integrations-window/*`; `src/components/window-content/org-owner-manage-window/ai-settings-tab.tsx`; `src/hooks/use-ai-config.ts` | No deep backend pricing refactors in lane `E` |
| `F` | Model quality conformance and multimodal/voice paths | `convex/ai/modelAdapters.ts`; `convex/ai/modelEnablementGates.ts`; voice runtime and eval tests | Starts only after core runtime adapters are stable |
| `G` | Migration, rollout hardening, and closeout | migrations + docs + rollout test assets | Starts only after all `P0` rows are `DONE` or `BLOCKED` |

---

## Dependency-based status flow

1. Start with lane `A` through `BMF-003`.
2. After `BMF-003`, lanes `B` and `C` may run in parallel (max one `IN_PROGRESS` per lane).
3. Lane `D` starts after `BMF-005` and `BMF-008` are `DONE`.
4. Lane `E` starts after `BMF-005` is `DONE`; lane `E` model controls (`BMF-014`) require `BMF-009`.
5. Lane `F` starts after `BMF-008`; voice and bridge tasks should reuse lane `E` connection contracts.
6. Lane `G` starts only after all `P0` rows are `DONE` or explicitly `BLOCKED`.

---

## Task queue

| ID | Lane | Plan | Priority | Status | Depends On | Task | Primary files | Verify | Notes |
|---|---|---:|---|---|---|---|---|---|---|
| `BMF-001` | `A` | 1 | `P0` | `DONE` | - | Deep baseline audit across AI runtime, integrations credential handling, credits/billing paths, and OpenClaw reference architecture | `convex/ai/chat.ts`; `convex/ai/agentExecution.ts`; `convex/ai/settings.ts`; `convex/credits/index.ts`; `convex/schemas/aiSchemas.ts`; `src/components/window-content/org-owner-manage-window/ai-settings-tab.tsx`; `convex/integrations/*`; `convex/oauth/encryption.ts`; `docs/reference_projects/openclaw/src/*`; `docs/reference_projects/openclaw/extensions/voice-call/src/*`; `docs/reference_docs/topic_collections/byok_infra/*` | `V-DOCS` | Done 2026-02-18: confirmed runtime is OpenRouter-first, BYOK UI is effectively disabled, credits are still deducted in BYOK paths, integration secrets are inconsistently encrypted, and OpenClaw already demonstrates provider/baseUrl/auth-profile patterns needed for private models and multimodal routing. |
| `BMF-002` | `A` | 1 | `P0` | `DONE` | `BMF-001` | Define canonical provider contract: provider IDs, credential source taxonomy, capability matrix (`text`, `vision`, `audio_in`, `audio_out`, `tools`, `json`), and billing source taxonomy (`platform`, `byok`, `private`) | `docs/reference_docs/topic_collections/implementation/byok-multimodal-frontier-runtime/MASTER_PLAN.md`; `convex/channels/types.ts`; `convex/ai/modelPolicy.ts`; `convex/ai/platformModels.ts` | `V-DOCS` | Done 2026-02-19: froze canonical provider/credential/capability/billing taxonomy in `MASTER_PLAN.md`, added reusable canonical AI taxonomy exports in `convex/channels/types.ts`, added provider/billing/capability normalization helpers in `convex/ai/modelPolicy.ts`, and exposed canonical provider/capability/billing fields in `convex/ai/platformModels.ts`. |
| `BMF-003` | `A` | 1 | `P0` | `DONE` | `BMF-002` | Land schema + migration contract for provider-agnostic AI settings and auth profiles | `convex/schemas/aiSchemas.ts`; `convex/schema.ts`; `convex/ai/settings.ts`; `convex/schemas/coreSchemas.ts` | `V-TYPE`; `V-LINT`; `V-AI-LINT` | Done 2026-02-19: added shared canonical taxonomy validators in `coreSchemas`, expanded `organizationAiSettings` to include provider-agnostic contract fields plus migration metadata, introduced `aiSettingsMigrations` receipts table, wired schema composition updates, and added migration-safe backfill/hydration scaffolding in `convex/ai/settings.ts` while preserving legacy OpenRouter fields. Verified with `npm run typecheck`, `npm run lint`, and `npx eslint convex/ai convex/schemas/aiSchemas.ts convex/credits/index.ts convex/channels` (warnings only). |
| `BMF-004` | `B` | 2 | `P0` | `DONE` | `BMF-003` | Implement encrypted AI credential storage with explicit encrypted field metadata and decrypt-on-use boundaries | `convex/oauth/encryption.ts`; `convex/channels/router.ts`; `convex/channels/types.ts`; `convex/integrations/manychat.ts`; `convex/integrations/chatwoot.ts`; `convex/integrations/resend.ts`; `convex/integrations/v0.ts` | `V-TYPE`; `V-LINT`; `V-INTEGRATION-LINT`; `V-UNIT` | Done 2026-02-19: expanded encrypted credential field support in channel routing, added encrypted field metadata + decrypt-on-use paths for ManyChat/Chatwoot/Resend/v0 object settings, and added migration-friendly legacy fallbacks where plaintext values may still exist. Verified with `npm run typecheck`, `npm run lint`, `npx eslint convex/integrations convex/oauth convex/channels/router.ts convex/channels/registry.ts`, and `npm run test:unit` (warnings only). |
| `BMF-005` | `B` | 2 | `P0` | `DONE` | `BMF-004` | Build AI provider registry + resolver (patterned after channel registry/router) with org binding, priority, and fallback metadata | `convex/channels/registry.ts`; `convex/channels/router.ts`; `convex/ai/modelDiscovery.ts`; `convex/ai/modelPricing.ts` | `V-TYPE`; `V-LINT`; `V-AI-LINT`; `V-UNIT` | Done 2026-02-19: added canonical AI provider registry + deterministic org binding resolver (priority ordering, fallback metadata, provider-specific `baseUrl`) in `convex/ai/providerRegistry.ts`, wired OpenRouter discovery credential/baseUrl resolution through registry bindings in `convex/ai/modelDiscovery.ts`, added provider-aware pricing binding metadata in `convex/ai/modelPricing.ts`, and added unit coverage in `tests/unit/ai/providerRegistry.test.ts`. Verified with `npm run typecheck`, `npm run lint`, `npx eslint convex/ai convex/schemas/aiSchemas.ts convex/credits/index.ts convex/channels`, and `npm run test:unit` (warnings only). |
| `BMF-006` | `B` | 2 | `P1` | `DONE` | `BMF-004` | Add provider connection verification actions (`test_auth`, `list_models`, `test_text`, `test_voice`) and health metadata | `convex/integrations/*`; `convex/ai/modelDiscovery.ts`; `src/components/window-content/integrations-window/*` | `V-TYPE`; `V-LINT`; `V-INTEGRATION-LINT` | Done 2026-02-19: added provider verification routing in `convex/integrations/aiConnections.ts` for `test_auth`/`list_models`/`test_text`/`test_voice`, added safe provider model/text probe internals in `convex/ai/modelDiscovery.ts`, and updated Integrations `AI Connections` UI action selector + health telemetry rendering in `src/components/window-content/integrations-window/ai-connections-settings.tsx`. Persisted only summarized health metadata (`status`, `reason`, `checkedAt`, `latencyMs`, `modelCount`, `voiceCount`, sampled model IDs) and preserved redaction/decrypt-on-use boundaries with no probe payload persistence. Regression risks reviewed pre-task: secret leakage in probe surfaces, accidental persistence of probe payload content, and UI/backend verification action mismatch causing false health states. Verified with `npm run typecheck` (fails with pre-existing `convex/ai/soulEvolution.ts:1568` TS2322), `npm run lint` (warnings only, pre-existing), and `npx eslint convex/integrations convex/oauth convex/channels/router.ts convex/channels/registry.ts` (warnings only, pre-existing). |
| `BMF-007` | `C` | 3 | `P0` | `DONE` | `BMF-003` | Generalize auth profile policy/order/cooldown from OpenRouter-only to provider-agnostic profile sets | `convex/ai/authProfilePolicy.ts`; `convex/ai/modelFailoverPolicy.ts`; `convex/ai/settings.ts` | `V-TYPE`; `V-LINT`; `V-AI-LINT`; `V-UNIT` | Done 2026-02-19: added provider-aware auth profile resolution/failure-count policy with OpenRouter compatibility wrappers, added provider metadata to model failover planning helpers, and made auth profile success/failure mutation paths provider-scoped while preserving legacy OpenRouter behavior. Verified with `npm run typecheck`, `npm run lint`, `npx eslint convex/ai convex/schemas/aiSchemas.ts convex/credits/index.ts convex/channels`, and `npm run test:unit` (warnings only). |
| `BMF-008` | `C` | 3 | `P0` | `DONE` | `BMF-007` | Implement provider adapter layer with normalized request/response for OpenRouter, OpenAI, Anthropic, Gemini, and OpenAI-compatible custom/private endpoints | `convex/ai/chat.ts`; `convex/ai/agentExecution.ts`; `convex/ai/openrouter.ts`; `convex/ai/modelAdapters.ts`; `convex/ai/toolBroker.ts` | `V-TYPE`; `V-LINT`; `V-AI-LINT`; `V-UNIT` | Done 2026-02-19: introduced a provider-agnostic adapter contract in `modelAdapters` + `openrouter` (OpenRouter/OpenAI/Anthropic/Gemini/OpenAI-compatible with baseUrl support), normalized usage/tool calls/structured output/error classes, wired chat + agent runtime to resolve provider-scoped auth profiles with OpenRouter compatibility fallback, and hardened tool-call envelope normalization. Verified with `npm run typecheck`, `npm run lint`, `npx eslint convex/ai convex/schemas/aiSchemas.ts convex/credits/index.ts convex/channels`, and `npm run test:unit` (warnings only where pre-existing lint warnings remain). |
| `BMF-009` | `C` | 3 | `P1` | `DONE` | `BMF-008` | Implement model routing matrix and per-agent fallback chain policy keyed by task intent and modality | `convex/ai/modelPolicy.ts`; `convex/ai/modelEnablementGates.ts`; `convex/ai/platformModels.ts`; `convex/ai/agentExecution.ts` | `V-TYPE`; `V-LINT`; `V-MODEL`; `V-UNIT` | Done 2026-02-19: added deterministic intent/modality routing matrix construction in `modelPolicy`, introduced reusable routing capability gate checks in `modelEnablementGates`, exposed routing gate metadata in `platformModels`, and wired agent runtime to execute provider-aware, cooldown-aware per-model fallback chains with deterministic fallback reason telemetry while preserving OpenRouter parity. Verified with `npm run typecheck`, `npm run lint`, `npm run test:model`, and `npm run test:unit` (lint warnings are pre-existing). |
| `BMF-010` | `D` | 4 | `P0` | `DONE` | `BMF-005`, `BMF-008` | Add billing-source policy engine so credit preflight/deduction depends on request source (`platform` vs `byok` vs `private`) | `convex/credits/index.ts`; `convex/ai/chat.ts`; `convex/ai/agentExecution.ts`; `convex/ai/agentApprovals.ts` | `V-TYPE`; `V-LINT`; `V-AI-LINT`; `V-UNIT` | Done 2026-02-19: landed deterministic credit policy resolution by request source and billing source, propagated explicit policy inputs through chat + agent + approvals runtime, and kept platform actions always billable even for BYOK/private LLM token paths. Verified with `npm run typecheck` (fails at `src/components/window-content/org-owner-manage-window/ai-settings-tab.tsx:38` due pre-existing deep type instantiation), `npm run lint`, `npx eslint convex/ai convex/schemas/aiSchemas.ts convex/credits/index.ts convex/channels`, and `npm run test:unit` (warnings only on lint checks). |
| `BMF-011` | `D` | 4 | `P1` | `DONE` | `BMF-010` | Finalize BYOK commercial model and stripe/invoice hooks (flat platform fee, optional surcharge, or tier-bundled) | `convex/stripe/aiCheckout.ts`; `convex/stripe/aiWebhooks.ts`; `convex/stripe/platformCheckout.ts`; `src/components/window-content/store-window.tsx` | `V-TYPE`; `V-LINT`; `V-UNIT` | Done 2026-02-19: added reusable BYOK commercial policy table with migration-safe defaults, wired Stripe checkout/subscription metadata + webhook policy snapshots, and surfaced explicit per-tier policy rows in store pricing transparency UI. Verified with `npm run typecheck` (same pre-existing `ai-settings-tab.tsx:38` deep type instantiation failure), `npm run lint`, and `npm run test:unit` (lint warnings only). |
| `BMF-012` | `D` | 4 | `P1` | `DONE` | `BMF-010` | Unify legacy token billing path with credits ledger or deprecate legacy path with hard guardrails | `convex/ai/billing.ts`; `convex/schemas/aiBillingSchemas.ts`; `convex/credits/index.ts` | `V-TYPE`; `V-LINT`; `V-UNIT` | Done 2026-02-19: made credits ledger authoritative via explicit legacy-token ledger guardrail policy, blocked legacy token mutation mode in `recordUsage`, required deterministic `creditLedgerAction` for credit-metered usage records, and added billing-source/request-source/ledger metadata fields in AI billing schema while keeping legacy subscription/token tables compatibility-readable. Verified with `npm run typecheck` (same pre-existing `ai-settings-tab.tsx:38` failure), `npm run lint`, and `npm run test:unit` (warnings only on lint checks). |
| `BMF-013` | `E` | 5 | `P0` | `DONE` | `BMF-005` | Build Integrations UI `AI Connections` for OpenAI, Anthropic, Gemini, Grok, Mistral, Kimi, OpenRouter, ElevenLabs, and custom OpenAI-compatible/private connectors | `src/components/window-content/integrations-window/index.tsx`; `src/components/window-content/integrations-window/*`; `src/hooks/use-ai-config.ts`; `convex/integrations/*` | `V-TYPE`; `V-LINT`; `V-UI-LINT`; `V-UNIT` | Done 2026-02-19: added `AI Connections` entry in Integrations UI, implemented connect/test/rotate/revoke provider flows with key-redaction UX in `ai-connections-settings.tsx`, and added secure provider connection handlers in `convex/integrations/aiConnections.ts` (OpenAI/Anthropic/Gemini/Grok/Mistral/Kimi/OpenRouter/ElevenLabs/OpenAI-compatible). Verified with `npm run typecheck` (fails on pre-existing implicit-any errors in `convex/ai/interviewRunner.ts:1327`, `convex/ai/interviewRunner.ts:1331`, `convex/ai/interviewRunner.ts:1335`), `npm run lint` (warnings only), `npx eslint src/components/window-content/integrations-window src/components/window-content/org-owner-manage-window/ai-settings-tab.tsx src/hooks/use-ai-config.ts` (warnings only), and `npm run test:unit` (pass). |
| `BMF-014` | `E` | 5 | `P1` | `DONE` | `BMF-013`, `BMF-009` | Update AI settings surfaces for per-agent provider/model defaults, fallback editor, and tier-based BYOK gating | `src/components/window-content/org-owner-manage-window/ai-settings-tab.tsx`; `src/hooks/use-ai-config.ts`; `convex/licensing/helpers.ts`; `convex/licensing/tierConfigs.ts` | `V-TYPE`; `V-LINT`; `V-UI-LINT` | Done 2026-02-19: removed hardcoded super-admin BYOK gating, introduced license/tier feature-based BYOK controls with explicit fallback UX, added provider default + fallback-chain editor and per-agent provider/model overrides in AI settings, extended `use-ai-config` with connection/license state, and added `aiByokEnabled` tier feature wiring in licensing config/helpers. Verified with `npm run typecheck` (same pre-existing `convex/ai/interviewRunner.ts` implicit-any failures), `npm run lint` (warnings only), and `npx eslint src/components/window-content/integrations-window src/components/window-content/org-owner-manage-window/ai-settings-tab.tsx src/hooks/use-ai-config.ts` (warnings only). |
| `BMF-015` | `F` | 6 | `P0` | `DONE` | `BMF-008`, `BMF-009` | Build provider/model conformance harness for tool-call parsing, schema fidelity, refusal handling, and latency/cost reliability | `tests/unit/ai/*`; `tests/integration/ai/*`; `scripts/test-model-validation.ts`; `convex/ai/modelAdapters.ts` | `V-TYPE`; `V-LINT`; `V-MODEL`; `V-UNIT`; `V-INTEGRATION` | Done 2026-02-19: added shared conformance evaluation contracts/thresholds and wired model enablement release gates to measurable pass/fail metrics (`tool_call_parse_rate`, `schema_fidelity_rate`, `refusal_handling_rate`, `latency_p95_ms`, `cost_per_1k_tokens_usd`), plus schema/payload persistence + harness reporting updates. Verified with `npm run typecheck` (initial run hit transient pre-existing `chat-input-redesign.tsx` TS2589/TS7006; later rerun passed), `npm run lint` (warnings only), `npm run test:model` (6/6 pass, conformance PASS), `npm run test:unit`, and `npm run test:integration`. |
| `BMF-016` | `F` | 6 | `P1` | `DONE` | `BMF-008`, `BMF-013` | Add multimodal voice path: ElevenLabs connector + internal voice provider routing for agent runtime and future voice agents | `convex/ai/agentExecution.ts`; `convex/integrations/*`; voice runtime modules; `docs/reference_projects/openclaw/extensions/voice-call/src/config.ts` | `V-TYPE`; `V-LINT`; `V-UNIT`; `V-INTEGRATION` | Done 2026-02-19: added modular voice runtime request parsing and provider-routed STT/TTS handling in agent execution, with provider factory routing to keep STT/TTS providers swappable without runtime rewrites, plus dedicated unit coverage for voice metadata parsing and routing fallback behavior. Verified with `npm run typecheck` (initial run hit transient pre-existing `chat-input-redesign.tsx` TS2589/TS7006; later rerun passed), `npm run lint` (warnings only), `npm run test:unit`, and `npm run test:integration`. |
| `BMF-017` | `F` | 6 | `P1` | `DONE` | `BMF-007`, `BMF-008` | Implement OpenClaw bridge proof-of-concept for importing external auth profiles/private model definitions into vc83 runtime | adapter/bridge modules + import tooling docs | `V-TYPE`; `V-LINT`; `V-UNIT` | Done 2026-02-19: shipped strict allowlist one-way OpenClaw import bridge (`openclawBridge` mapping + mutation + CLI/docs), deterministic dedupe/merge behavior for auth profiles/private models, and org-bound import authorization guards while preserving existing profile failure/cooldown metadata. Verified with `npm run typecheck`, `npm run lint` (warnings only), and `npm run test:unit`. |
| `BMF-018` | `G` | 7 | `P0` | `DONE` | `BMF-011`, `BMF-014`, `BMF-016` | Run migration/backfill + feature-flag rollout plan (org settings migration, key rotation safety, fallback rollback) | migration scripts; `convex/migrations/*`; `docs/reference_docs/topic_collections/implementation/byok-multimodal-frontier-runtime/*` | `V-TYPE`; `V-LINT`; `V-UNIT`; `V-DOCS` | Done 2026-02-19: confirmed all pre-`BMF-018` `P0` rows were `DONE`, added lane-G rollout migration runner in `convex/migrations/byokProviderAgnosticRollout.ts` (audit/backfill/rollback batches with canary support), added emergency rollback mutation `internal.ai.settings.rollbackProviderAgnosticSettings`, added `LANE_G_ROLLOUT_RUNBOOK.md` with canary/rollback commands, and hardened key-rotation recovery in `convex/integrations/aiConnections.ts` by clearing cooldown/failure counters on API key change. Regression risks reviewed pre-task: unintended writes to already-migrated orgs, stale cooldown after key rotation, incomplete rollback semantics. Verified with `npm run typecheck` (fails with pre-existing `convex/ai/workerPool.ts` TS7006/TS2698), `npm run lint` (warnings only), `npm run test:unit` (pass), and `npm run docs:guard` (pass). |
| `BMF-019` | `G` | 7 | `P1` | `DONE` | `BMF-018`, `BMF-015`, `BMF-017` | Final hardening, CI closeout, and release checklist for multi-provider BYOK GA | `docs/reference_docs/topic_collections/implementation/byok-multimodal-frontier-runtime/*`; tests and guardrail docs | `V-TYPE`; `V-LINT`; `V-UNIT`; `V-MODEL`; `V-DOCS` | Done 2026-02-19: finalized lane-G release assets in `GA_HARDENING_CHECKLIST.md`, linked migration rollback/key-rotation recovery runbooks, and completed CI closeout verification. Regression risks reviewed pre-task: release gating gaps, conformance gate omission, and operational key-rotation recovery drift. Verified with `npm run typecheck` (same pre-existing `convex/ai/workerPool.ts` TS7006/TS2698), `npm run lint` (warnings only), `npm run test:unit` (pass), `npm run test:model` (6/6 tests, conformance `PASS`), and `npm run docs:guard` (pass). |

---

## Current kickoff

- Active task: none.
- Next task to execute: none (`BMF-001`..`BMF-019` are `DONE`).
- Immediate objective: queue execution is complete; maintain docs/runbooks and monitor regressions.
