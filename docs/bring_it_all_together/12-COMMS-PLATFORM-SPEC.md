# L4YERCAK3 Communications Platform — Design Specification

## Context

L4YERCAK3 is a multi-tenant platform with a **four-level hierarchy**:

1. **Platform** (L4YERCAK3 itself — the "super organization")
2. **Agency Owner** (organizations building on the platform)
3. **Agency Customer** (the agency owner's direct client / organization)
4. **End User** (the agency customer's users — the people actually using the deployed web apps)

Communications must work clearly across all four levels. Everything available on the web platform must also work on the iPhone app, scoped to the user's organization context.

---

## Core Communication Primitives

The system has **three distinct communication types**:

### 1. Chats (Direct Messaging)

- One-on-one, DM-style messaging between users
- Scoped to organization membership — users can only message other members within shared organizations
- **Cross-organization messaging** is determined by each organization's settings. An organization opts in or out of allowing its members to be messaged by users from other organizations. If both orgs allow it, the message can flow.
- Per-organization toggle: users can turn chat on/off for each organization they belong to
- User blocking support
- Notification controls:
  - Sound and visual alerts toggle
  - Email notification toggle for messages
  - "Who can message me" permissions
  - Blocked users list

### 2. Live Community Feed (Broadcasts + Activity)

- A live feed scoped to each organization
- **Agency owners can broadcast to all their customers** via the feed
- Platform-level broadcasts from L4YERCAK3 (super organization) appear across all feeds with special platform badging
- Supports activity-driven items: new followers, likes, affiliate referrals, caching events
- Lightweight to start — not a full community platform, just a chronological feed of broadcasts and activity within an org
- Can evolve incrementally toward richer community features over time

### 3. Notifications (System Events + Alerts)

- Event-driven alerts tied to platform and organization activity
- Notification types include:
  - New follower
  - Likes
  - Caching events
  - Affiliate referral
  - Web app events (generated by deployed applications)
  - Platform announcements
- Per-organization notification settings (users configure independently for each org)
- Delivery channel preferences (in-app, email, push, external integrations)

---

## Notification Priority Schema

A tiered priority system determines delivery urgency and channel escalation:

| Priority Level | Who Sets It | Behavior |
|---|---|---|
| **Critical** | Platform (super admin only) | All channels, immediate, cannot be muted |
| **High** | Agency owners | Push + in-app + email by default, user can downgrade |
| **Normal** | Any org-level sender | In-app + optional push/email per user preference |
| **Low** | System-generated activity | In-app only, batched/digest-friendly |

- The **platform super admin always has highest priority** — platform-level critical notifications override user muting preferences
- Agency owners and their customers choose the priority level when sending broadcasts or triggering notifications
- Users control how each priority level reaches them (except Critical)

---

## AI-Powered Web App Communications (Layer 4)

End users (Layer 4) interact with deployed web applications, not directly with the platform UI. Their communication layer is **AI-driven**:

- Web apps deployed on L4YERCAK3 generate communications on behalf of their parent organization
- AI agents handle conversations with end users inside the web app context
- These AI-mediated communications flow up the hierarchy: End User ↔ AI Agent ↔ Agency Customer ↔ Agency Owner
- The AI layer abstracts the platform's communication infrastructure so end users experience natural in-app interaction without needing to know about L4YERCAK3

---

## Communication Flows Across the Hierarchy

| From → To | Channel | Example |
|---|---|---|
| Platform → All | Feed broadcast + Critical notification | Platform updates, maintenance, feature launches |
| Platform → Agency Owner | Chat + Notification | Billing alerts, compliance, direct support |
| Agency Owner → Agency Customers | Feed broadcast + Notification | Product updates, announcements |
| Agency Owner → Specific Customer | Chat | Direct support, onboarding |
| Agency Customer → Agency Owner | Chat | Support requests, questions |
| Agency Customer → End Users | AI-powered web app comms | In-app messaging, automated workflows |
| End User → Agency Customer | AI-powered web app comms | Support, feedback, transactions |
| User ↔ User (within org) | Chat | Direct messaging (if org allows) |
| User ↔ User (cross-org) | Chat | Only if both organizations enable cross-org messaging |

---

## External Communication Integrations

The platform has its own internal communication system, but external integrations plug in as **additional delivery channels**, handled separately from the core system.

### Architecture

- **Internal system** = chats, feed, notifications (native to L4YERCAK3)
- **External integrations** = third-party delivery channels that receive events from the internal system and route them outward

### Known Integrations

- **Pushover** (currently integrated)
- Future: SMS providers, email services, Slack, WhatsApp, custom webhooks, etc.

### Integration Behavior

- External integrations are configured per organization
- Each integration maps to notification types and priority levels (e.g., "send Critical and High priority notifications via Pushover")
- Users can opt in/out of external delivery channels in their notification settings
- External integrations do not replace the internal system — they extend it

---

## Organization-Scoped Communication Settings

Since users can belong to multiple organizations, all communication is grouped by organization context.

### Organization-Level Settings (set by org admin)

- Cross-organization messaging: enabled/disabled
- Available external integrations
- Default notification priorities for org-generated events
- Feed moderation rules

### User-Level Settings (per organization)

- Chat availability: on/off per org
- Notification preferences per type and priority
- External integration opt-in/out
- Sound, visual, and email alert toggles
- Blocked users list

---

## Cross-Platform Requirements

- Web platform and iPhone app must have feature parity for communications
- iPhone app connects to the platform, scoped to the user + their organization(s)
- Push notifications on mobile map to the notification priority schema
- Chat and feed sync in real-time across web and mobile
- AI web app communications are primarily web-based but notification events can route to mobile

---

## Implementation Phases (Suggested)

### Phase 1 — Foundation
- Internal chat (1:1 DMs, org-scoped)
- Basic notification system with in-app delivery
- Notification settings per org per user
- Platform super organization with visual badging

### Phase 2 — Feed + Broadcasts
- Live community feed per organization
- Agency owner broadcast capability
- Platform-level broadcast to all feeds
- Feed activity items (follows, likes, referrals)

### Phase 3 — Priority + External Integrations
- Notification priority schema (Critical / High / Normal / Low)
- Pushover integration as first external channel
- Integration configuration UI per organization
- User opt-in/out for external channels

### Phase 4 — AI Communications Layer
- AI agent framework for web app communications
- End user ↔ AI ↔ organization communication flow
- Event routing from web apps into the notification system

### Phase 5 — Cross-Org + Advanced
- Cross-organization messaging (org-level toggle)
- Additional external integrations (SMS, Slack, WhatsApp, webhooks)
- Group chats / channels within organizations
- Rich feed features (comments, reactions, threads)